!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([,function(e,t){var i='{"height":24,"infinite":false,"layers":[{"data":[1,1,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,1,1,1,1,1,1,1,1,1,1,1,1,1,7,7,1,1,1,1,1,1,1,1,3,2,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,3,2,2,3,2,2,2,2,2,2,2,3,2,1,1,1,1,1,1,1,3,2,7,1,1,1,7,1,1,1,7,2,3,1,1,3,1,1,1,1,1,1,1,3,2,7,7,7,7,7,7,7,3,2,7,1,1,1,7,1,1,1,7,2,3,1,7,3,1,1,1,7,7,7,7,3,2,2,2,2,2,2,2,2,2,2,7,1,1,1,7,1,1,1,7,2,3,3,2,2,1,1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,7,1,1,1,7,1,1,1,7,2,3,3,1,1,1,1,3,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,7,1,1,1,7,1,1,1,7,2,3,3,7,1,1,1,3,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,7,1,1,1,7,1,1,1,7,2,3,2,2,3,1,1,3,7,7,7,7,7,2,7,7,7,7,7,7,7,7,2,1,1,7,1,1,1,7,1,1,2,3,1,1,3,1,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,1,7,3,1,3,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,1,1,1,1,1,1,1,1,1,1,7,3,3,2,2,1,3,7,7,1,7,7,1,1,1,1,3,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,7,3,3,1,1,7,2,2,2,3,2,2,2,7,7,7,3,1,1,7,7,7,7,7,1,1,2,2,2,2,2,2,7,3,3,7,1,7,7,7,7,3,7,7,7,7,7,7,3,1,3,2,2,2,2,2,1,1,2,2,7,7,7,2,7,3,2,2,3,7,2,2,2,3,2,2,2,7,7,7,3,1,3,1,1,7,7,7,7,7,1,2,2,7,7,2,7,3,1,1,3,7,2,7,2,3,2,7,2,7,7,7,3,1,3,1,3,2,2,2,2,2,1,1,2,2,7,2,7,3,1,7,3,7,2,2,2,3,2,2,2,7,7,7,3,1,3,1,3,1,1,7,7,7,7,7,1,2,2,2,7,3,3,2,2,7,1,1,1,3,1,1,1,7,7,7,3,1,3,1,3,1,3,2,2,2,2,2,1,1,1,1,7,3,3,1,1,7,2,2,2,3,2,2,2,7,7,7,3,1,3,1,3,1,3,1,1,7,7,7,7,7,1,1,7,3,3,7,1,7,2,7,2,3,2,7,2,7,7,7,3,1,3,1,3,1,3,1,3,2,2,2,2,2,1,1,7,3,2,2,3,7,2,7,2,3,2,7,2,7,7,7,3,1,3,1,3,1,3,1,3,1,1,7,7,7,7,7,7,3,1,1,3,7,2,2,2,3,2,2,2,7,7,7,3,1,3,1,3,1,3,1,3,1,3,2,2,2,2,2,7,3,4,1,3,1,1,1,1,3,1,1,1,1,1,1,3,1,3,1,3,1,3,1,3,1,3,1,1,1,1,1,7,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],"height":24,"name":"level","opacity":1,"type":"tilelayer","visible":true,"width":32,"x":0,"y":0}],"nextobjectid":10,"orientation":"orthogonal","renderorder":"right-down","tiledversion":"1.1.6","tileheight":32,"tilesets":[{"columns":7,"firstgid":1,"image":"../../assets/tileset.png","imageheight":32,"imagewidth":224,"margin":0,"name":"js13k","spacing":0,"tilecount":7,"tileheight":32,"tileproperties":{"0":{"isStable":false,"name":"air"},"1":{"isStable":true,"name":"floor"},"2":{"isStable":true,"name":"ladder"},"3":{"isStable":false,"name":"door"},"4":{"isStable":false,"name":"player"},"5":{"isStable":false,"name":"enemy"},"6":{"isStable":false,"name":"battery"}},"tilepropertytypes":{"0":{"isStable":"bool","name":"string"},"1":{"isStable":"bool","name":"string"},"2":{"isStable":"bool","name":"string"},"3":{"isStable":"bool","name":"string"},"4":{"isStable":"bool","name":"string"},"5":{"isStable":"bool","name":"string"},"6":{"isStable":"bool","name":"string"}},"tilewidth":32}],"tilewidth":32,"type":"map","version":1,"width":32}',n=ga(1024,768,function(){let e=new(window.AudioContext||window.webkitAudioContext);function t(e,t,i){let o=n.sprite({image:"tileset.png",x:160,y:0,width:32,height:32});return o.spawnX=e,o.spawnY=t,o.x=o.spawnX,o.y=o.spawnY,o.id=i,o.movement={falling:!1,moving:!1,stuck:!1,stuckAt:void 0,direction:directions.still},o.allowMoveAgain=function(){o.movement.moving=!1},o.makeStuck=function(e){this.movement.moving=!1,this.movement.falling=!1,this.movement.stuck=!0,this.inHoleRef=e,this.movement.stuckAt=Date.now()},o.unStick=function(){this.movement.stuck=!1,this.inHoleRef=void 0,this.movement.stuckAt=void 0,this.climbingOut=!0},o.climbingOut=!1,o.currentTile=n.getSpriteIndex(o),o.dead=!1,o.freshSpawn=!0,o.inHoleRef=void 0,o.needsPath=!0,o.pathData={path:null,updated:null,distance:null},o}d=new class{constructor(e){this.ctx=e}init(){this.oscillator=this.ctx.createOscillator(),this.gainNode=this.ctx.createGain(),this.oscillator.connect(this.gainNode),this.gainNode.connect(this.ctx.destination),this.oscillator.type="sine"}play(e,t){this.init(),this.oscillator.frequency.value=e,this.gainNode.gain.setValueAtTime(.5,this.ctx.currentTime),this.oscillator.start(t),this.stop(t)}stop(e){this.gainNode.gain.exponentialRampToValueAtTime(.001,e+.25),this.oscillator.stop(e+.25)}battery(){this.play(8e3,this.ctx.currentTime)}move(){this.play(5,this.ctx.currentTime)}doorOpen(){this.play(261.63,this.ctx.currentTime+.25),this.play(329.63,this.ctx.currentTime+.35)}win(){this.play(261.63,this.ctx.currentTime+.25),this.play(329.63,this.ctx.currentTime+.35),this.play(392,this.ctx.currentTime+.45),this.play(523.25,this.ctx.currentTime+.55)}lose(){this.play(261.63,this.ctx.currentTime+.25),this.play(246.94,this.ctx.currentTime+.35),this.play(233.08,this.ctx.currentTime+.45)}blast(){this.play(185,this.ctx.currentTime+.25)}}(e),n.canvas.style.border="none",n.backgroundColor="black",endMessage=n.text("Placeholder Text","32px Consolas","#15e815",0,0),(a=n.group(endMessage)).visible=!1,(c=n.text("Sir! That earthquake knocked the building offline! The bio-restraint has failed!","22px Consolas","#15e815",0,0)).x=15,c.y=150,(u=n.text("Electronics are dead, batteries scattered, and the security-organics are haywire!","22px Consolas","#15e815",0,0)).x=15,u.y=250,introMessage3=n.text("The door cycle will drain reserve. Go retrive the batteries so we can fix this!","22px Consolas","#15e815",0,0),introMessage3.x=15,introMessage3.y=350,introMessage4=n.text("You're the best Organic Electro-Chemical Technician we've got. Stay safe! [SPACE]","22px Consolas","#15e815",0,0),introMessage4.x=15,introMessage4.y=450,introScene=n.group(c,u,introMessage3,introMessage4),introScene.visible=!1,f=n.text("---- O.E.C.T. ----","64px Consolas","#15e815",0,0),h=n.text("By Ben Fox.","32px Consolas","#15e815",0,0),p=n.text("[ SPACE ] to page/pause.","32px Consolas","#15e815",0,0),m=n.text("[ A/D ] to blast the floor. [ ARROWS ] to move.","32px Consolas","#15e815",0,0),f.x=190,f.y=250,h.x=400,h.y=350,p.x=290,p.y=400,m.x=100,m.y=450,titleScreen=n.group(f,h,p,m),titleScreen.visible=!1,world=n.makeTiledWorld(i,"tileset.png"),l=n.group(),r=world.getObjects(n.tileTypes.door),y=world.getObjects(n.tileTypes.floor),v=world.getObjects(n.tileTypes.ladder),g=world.getObjects(n.tileTypes.battery),r.forEach(e=>{l.addChild(e),e.canUse=!1,e.alpha=.25,w[e.index]=e}),y.forEach(e=>{l.addChild(e)}),g.forEach(e=>{l.addChild(e),x[e.index]=e}),k=Object.keys(x).length,v.forEach(e=>{l.addChild(e)}),directions={up:"u",down:"d",left:"l",right:"r",current:"c",still:"still"},o=function(e,t){let i=n.sprite({image:"tileset.png",x:128,y:0,width:32,height:32});return i.spawnX=32,i.spawnY=704,i.x=i.spawnX,i.y=i.spawnY,i.dead=!1,i.won=!1,i.landingTile=void 0,i.movement={falling:!1,moving:!1,direction:directions.still},i.freshSpawn=!0,i.currentTile=n.getSpriteIndex(i),i}(),l.addChild(o),s.push(t(672,256,1)),s.push(t(0,128,2)),s.push(t(320,352,3)),s.push(t(288,32,4)),s.push(t(928,704,5)),s.forEach(e=>{l.addChild(e)}),levelGraph=function(){const e={};objects=world.objects;let t=1;for(objects.length;t<objects.length;t++){let i=objects[t];i.name!==n.tileTypes.floor&&(ruleOut={current:n.getAdjacentTile(i.index,"c"),below:n.getAdjacentTile(i.index,"d")},(ruleOut.current.type===n.tileTypes.ladder||ruleOut.below.isStable)&&(e[i.index]={},adjTiles=n.getAdjacentTiles(i.index),B(o,adjTiles.c,adjTiles.u)&&(e[i.index][adjTiles.u.index]=1),B(o,adjTiles.c,adjTiles.d)&&(e[i.index][adjTiles.d.index]=1),B(o,adjTiles.c,adjTiles.l)&&(e[i.index][adjTiles.l.index]=1),B(o,adjTiles.c,adjTiles.r)&&(e[i.index][adjTiles.r.index]=1)))}return e}(),dijkstra2=new function(e){this.vertices=e,this.addVertex=function(e,t){this.vertices[e]=t},this.shortestPath=function(e,t){e=e.toString(),t=t.toString();var i,n,o,s,r=new function(){this._nodes=[],this.enqueue=function(e,t){this._nodes.push({key:t,priority:e}),this.sort()},this.dequeue=function(){return this._nodes.shift().key},this.sort=function(){this._nodes.sort(function(e,t){return e.priority-t.priority})},this.isEmpty=function(){return!this._nodes.length}},l={},a={},d=[];for(n in this.vertices)n===e?(l[n]=0,r.enqueue(0,n)):(l[n]=1/0,r.enqueue(1/0,n)),a[n]=null;for(;!r.isEmpty();){if((i=r.dequeue())===t){for(d=[];a[i];)d.push(Number(i)),i=a[i];break}if(i&&l[i]!==1/0)for(o in this.vertices[i])(s=l[i]+this.vertices[i][o])<l[o]&&(l[o]=s,a[o]=i,r.enqueue(s,o))}return{path:d.concat([Number(e)]).reverse(),distance:d.length,updated:Date.now()}}}(levelGraph),n.key.space.press=function(){n.state===D?(n.shake(titleScreen,16,!1,120),T?(clearTimeout(T),n.state=M):T=n.wait(2e3,()=>{n.state=M})):n.state===M?(T&&(T=void 0),n.state=Y,l.visible=!0,introScene.visible=!1):n.state===Y?n.paused&&!o.dead?n.resume():n.pause():n.state!==A&&n.state!==j||location.reload()},n.key.rightArrow.press=function(){o.movement.direction=directions.right},n.key.leftArrow.press=function(){o.movement.direction=directions.left},n.key.upArrow.press=function(){o.movement.direction=directions.up},n.key.downArrow.press=function(){o.movement.direction=directions.down},n.key.a.press=function(){O("dl")},n.key.d.press=function(){O("dr")},n.key.rightArrow.release=function(){o.movement.direction===directions.right&&(o.movement.direction=directions.still)},n.key.leftArrow.release=function(){o.movement.direction===directions.left&&(o.movement.direction=directions.still)},n.key.upArrow.release=function(){o.movement.direction===directions.up&&(o.movement.direction=directions.still)},n.key.downArrow.release=function(){o.movement.direction===directions.down&&(o.movement.direction=directions.still)},n.state=D},["tileset.png"]);document.getElementById("restart").addEventListener("click",()=>{location.reload()});var o,s,r,l,a,d,c,u,h,p,m,f,y,v,g,T,b={playerMoveSpeed:150,enemyMoveSpeed:250,blockRespawnSpeed:3300,introTextFadein:2e3,pathUpdateFrequency:500,enemyUnstuckSpeed:void 0,difficulties:{easy:"easy",normal:"normal",hard:"hard"},difficulty:void 0};b.difficulty=b.difficulties.normal,b.enemyUnstuckSpeed=b.blockRespawnSpeed/3,n.start(),destroyedBlocks={queue:[],hash:{}};const x={},w={};let k=0,S=0;function j(){l.visible=!1,a.visible=!0,titleScreen.visible=!1,endMessage.content="Oh no! You're part of the building, now.",endMessage.x=155,endMessage.y=n.canvas.height/2-35}function A(){l.visible=!1,titleScreen.visible=!1,a.visible=!0,endMessage.content="You made it! Nice work!",endMessage.x=300,endMessage.y=n.canvas.height/2-35}function D(){titleScreen.visible=!0,l.visible=!1,a.visible=!1,introScene.visible=!1}function M(){l.visible=!1,titleScreen.visible=!1,a.visible=!1,introScene.visible=!0}function O(e){if(currentTile=n.getSpriteIndex(o),tileToDestroy=n.getAdjacentTile(currentTile,e),aboveTile=n.getAdjacentTile(tileToDestroy.index,directions.up),!destroyedBlocks.hash[tileToDestroy.index]&&aboveTile.type!==n.tileTypes.floor&&(spriteToDestroy=y.find(e=>e.index===tileToDestroy.index),spriteToDestroy&&spriteToDestroy.visible)){let s=1;"dl"===e&&(s*=-1);var t=n.line("yellow",3,o.centerX+10*s,o.centerY+2,spriteToDestroy.centerX+2*s,spriteToDestroy.centerY-16);n.wait(35,()=>{n.remove(t)}),d.blast(),world.children[0].data[tileToDestroy.index]=1,n.fadeOut(spriteToDestroy,15);let r={sprite:spriteToDestroy,tile:tileToDestroy,time:Date.now(),occupied:!1,occupy:function(){this.occupied=!0,world.children[0].data[this.tile.index]=2},vacate:function(){this.occupied=!1,world.children[0].data[this.tile.index]=1}};i=r,destroyedBlocks.hash[i.tile.index]=i,destroyedBlocks.queue.push(i.tile.index)}var i}function C(){let e=destroyedBlocks.queue[0],t=destroyedBlocks.hash[e];e===o.currentTile&&(d.lose(),o.dead=!0,o.visible=!1,setTimeout(function(){n.resume(),n.state=j},1500),n.pause()),delete destroyedBlocks.hash[destroyedBlocks.queue.shift()],world.children[0].data[t.tile.index]=2;n.fadeIn(t.sprite,6)}function B(e,t,i){switch(t.index-i.index){case 32:if(i.type&&t.type===n.tileTypes.ladder&&i.type!==n.tileTypes.floor)return!0;break;case-32:if(i.type&&t.type===n.tileTypes.ladder&&i.type!==n.tileTypes.floor||i.type&&i.type===n.tileTypes.ladder||i.type&&e.movement.falling)return!0;break;case-1:case 1:if(i.type&&i.type!==n.tileTypes.floor)return!0;break;default:return!1}}function q(e,t,i){let o=n.getAdjacentTile(t,directions.current),s=n.getAdjacentTile(t,i);if(canMove=B(e,o,s),canMove){let i=s.index,o=(n.getTile(t,world.objects[0].data,world),n.getTile(i,world.objects[0].data,world));return nextX=o.x,nextY=o.y,e.x=nextX,e.y=nextY,e.currentTile=i,!0}return!1}function E(e){return thisTile=n.getAdjacentTile(e.currentTile,directions.current),belowTile=n.getAdjacentTile(e.currentTile,directions.down),!(thisTile.type===n.tileTypes.ladder||belowTile.isStable||!belowTile.index)}function P(){o.movement.moving=!1}function R(e){var t;!e.dead&&destroyedBlocks.hash[e.inHoleRef.tile.index]?(e.inHoleRef.vacate(),e.unStick()):(e.dead=!0,e.visible=!1,(t=e).needsPath=!0,t.x=t.spawnX,t.y=t.spawnY,t.currentTile=n.getSpriteIndex(t),t.inHoleRef=void 0,t.freshSpawn=!0,t.movement={falling:!1,moving:!1,stuck:!1,stuckAt:void 0,direction:directions.still},t.pathData={path:null,updated:null,distance:null},setTimeout(function(){t.visible=!0},250),setTimeout(function(){t.dead=!1},1e3))}function Y(){!function(){if(o.freshSpawn&&(o.movement.falling=E(o),o.freshSpawn=!1),!o.movement.moving){let e;if(o.movement.falling?e=q(o,o.currentTile,directions.down):o.movement.direction!==directions.still&&(e=q(o,o.currentTile,o.movement.direction)),e&&(d.move(),o.movement.moving=!0,n.wait(b.playerMoveSpeed,P)),o.movement.falling=E(o),o.movement.falling&&!o.landingTile)for(idx=o.currentTile;!o.landingTile;){let e=world.tileTypes[world.objects[0].data[idx]-1];e&&e.isStable?o.landingTile=idx-32:e?idx+=32:o.landingTile=idx-32}else o.movement.falling||(o.landingTile=void 0)}}(),x[o.currentTile]&&x[o.currentTile].visible&&(x[o.currentTile].visible=!1,S++,d.battery(),k===S&&(d.doorOpen(),r.forEach(e=>{e.alpha=1,e.canUse=!0}))),!o.won&&w[o.currentTile]&&w[o.currentTile].canUse&&(o.won=!0,d.win(),n.state=A),s.forEach(e=>{e.dead||(function(e){if(e.freshSpawn&&(e.movement.falling=E(e),e.freshSpawn=!1),!e.movement.moving){if(e.movement.stuck||(e.movement.falling=E(e)),!e.movement.falling&&e.needsPath){let t=0;e.movement.stuck&&(t=32),b.difficulty===b.difficulties.hard?e.pathData=dijkstra2.shortestPath(e.currentTile-t,o.movement.falling?o.landingTile:o.currentTile):e.pathData=dijkstra2.shortestPath(e.currentTile-t,o.currentTile),e.needsPath=!1}!e.movement.falling&&Date.now()-e.pathData.updated>b.pathUpdateFrequency&&(e.needsPath=!0),e.movement.stuck&&Date.now()-e.movement.stuckAt>b.enemyUnstuckSpeed&&R(e);let s=!1,r=e.pathData.path?e.pathData.path[0]:void 0,l=e.pathData.path?e.pathData.path[1]:void 0;e.movement.stuck||(e.movement.falling?(destroyedBlocks.hash[e.currentTile+32]&&!destroyedBlocks.hash[e.currentTile+32].occupied||!destroyedBlocks.hash[e.currentTile+32])&&(s=q(e,e.currentTile,directions.down)):l&&(e.movement.direction=(i=l)<(t=r)?i+1===t?directions.left:directions.up:i>t?i-1===t?directions.right:directions.down:void 0,s=q(e,r,e.movement.direction)),s&&(!e.movement.falling&&e.pathData.path&&e.pathData.path.shift(),e.movement.moving=!0,n.wait(b.enemyMoveSpeed,e.allowMoveAgain))),e.movement.stuck||(e.movement.falling=E(e))}var t,i}(e),e.movement.stuck||(e.currentTile===o.currentTile&&(d.lose(),o.dead=!0,setTimeout(function(){n.resume(),n.state=j},1500),n.pause()),function(e){let t=destroyedBlocks.hash[e.currentTile];t&&(e.makeStuck(t),t.occupy())}(e)))}),function(){try{destroyedBlocks.queue.length&&Date.now()-destroyedBlocks.hash[destroyedBlocks.queue[0]].time>b.blockRespawnSpeed&&C()}catch(e){}}()}s=[]}]);