!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([,function(e,t){var i=ga(1024,768,function(){let e=new(window.AudioContext||window.webkitAudioContext);function t(e,t,n){let o=i.sprite({image:"tileset.png",x:160,y:0,width:32,height:32});return o.spawnX=e,o.spawnY=t,o.x=o.spawnX,o.y=o.spawnY,o.id=n,o.movement={falling:!1,moving:!1,stuck:!1,stuckAt:void 0,direction:directions.still},o.allowMoveAgain=function(){o.movement.moving=!1},o.makeStuck=function(e){this.movement.moving=!1,this.movement.falling=!1,this.movement.stuck=!0,this.inHoleRef=e,this.movement.stuckAt=Date.now()},o.unStick=function(){this.movement.stuck=!1,this.inHoleRef=void 0,this.movement.stuckAt=void 0,this.climbingOut=!0},o.climbingOut=!1,o.currentTile=i.getSpriteIndex(o),o.dead=!1,o.freshSpawn=!0,o.inHoleRef=void 0,o.needsPath=!0,o.pathData={path:null,updated:null,distance:null},o}a=new class{constructor(e){this.ctx=e}init(){this.oscillator=this.ctx.createOscillator(),this.gainNode=this.ctx.createGain(),this.oscillator.connect(this.gainNode),this.gainNode.connect(this.ctx.destination),this.oscillator.type="sine"}play(e,t){this.init(),this.oscillator.frequency.value=e,this.gainNode.gain.setValueAtTime(.5,this.ctx.currentTime),this.oscillator.start(t),this.stop(t)}stop(e){this.gainNode.gain.exponentialRampToValueAtTime(.001,e+.25),this.oscillator.stop(e+.25)}battery(){this.play(8e3,this.ctx.currentTime)}move(){this.play(5,this.ctx.currentTime)}doorOpen(){this.play(261.63,this.ctx.currentTime+.25),this.play(329.63,this.ctx.currentTime+.35)}win(){this.play(261.63,this.ctx.currentTime+.25),this.play(329.63,this.ctx.currentTime+.35),this.play(392,this.ctx.currentTime+.45),this.play(523.25,this.ctx.currentTime+.55)}lose(){this.play(261.63,this.ctx.currentTime+.25),this.play(246.94,this.ctx.currentTime+.35),this.play(233.08,this.ctx.currentTime+.45)}blast(){this.play(185,this.ctx.currentTime+.25)}}(e),i.canvas.style.border="none",i.backgroundColor="black",endMessage=i.text("Placeholder Text","32px Consolas","#15e815",0,0),(l=i.group(endMessage)).visible=!1,(d=i.text("Sir! That earthquake knocked the building offline! The bio-restraint has failed!","22px Consolas","#15e815",0,0)).x=15,d.y=150,(c=i.text("Electronics are dead, batteries scattered, and the security-organics are haywire!","22px Consolas","#15e815",0,0)).x=15,c.y=250,introMessage3=i.text("The door cycle will drain reserve. Go retrive the batteries so we can fix this!","22px Consolas","#15e815",0,0),introMessage3.x=15,introMessage3.y=350,introMessage4=i.text("You're the best Organic Electro-Chemical Technician we've got. Stay safe! [SPACE]","22px Consolas","#15e815",0,0),introMessage4.x=15,introMessage4.y=450,introScene=i.group(d,c,introMessage3,introMessage4),introScene.visible=!1,m=i.text("---- O.E.C.T. ----","64px Consolas","#15e815",0,0),u=i.text("By Ben Fox.","32px Consolas","#15e815",0,0),h=i.text("[ SPACE ] to page/pause.","32px Consolas","#15e815",0,0),p=i.text("[ A/D ] to blast the floor. [ ARROWS ] to move.","32px Consolas","#15e815",0,0),m.x=190,m.y=250,u.x=400,u.y=350,h.x=290,h.y=400,p.x=100,p.y=450,titleScreen=i.group(m,u,h,p),titleScreen.visible=!1,world=i.makeTiledWorld("world.json","tileset.png"),r=i.group(),s=world.getObjects(i.tileTypes.door),f=world.getObjects(i.tileTypes.floor),y=world.getObjects(i.tileTypes.ladder),v=world.getObjects(i.tileTypes.battery),s.forEach(e=>{r.addChild(e),e.canUse=!1,e.alpha=.25,w[e.index]=e}),f.forEach(e=>{r.addChild(e)}),v.forEach(e=>{r.addChild(e),x[e.index]=e}),b=Object.keys(x).length,y.forEach(e=>{r.addChild(e)}),directions={up:"u",down:"d",left:"l",right:"r",current:"c",still:"still"},n=function(e,t){let n=i.sprite({image:"tileset.png",x:128,y:0,width:32,height:32});return n.spawnX=32,n.spawnY=704,n.x=n.spawnX,n.y=n.spawnY,n.dead=!1,n.won=!1,n.landingTile=void 0,n.movement={falling:!1,moving:!1,direction:directions.still},n.freshSpawn=!0,n.currentTile=i.getSpriteIndex(n),n}(),r.addChild(n),o.push(t(672,256,1)),o.push(t(0,128,2)),o.push(t(320,352,3)),o.push(t(288,32,4)),o.push(t(928,704,5)),o.forEach(e=>{r.addChild(e)}),levelGraph=function(){const e={};objects=world.objects;let t=1;for(objects.length;t<objects.length;t++){let o=objects[t];o.name!==i.tileTypes.floor&&(ruleOut={current:i.getAdjacentTile(o.index,"c"),below:i.getAdjacentTile(o.index,"d")},(ruleOut.current.type===i.tileTypes.ladder||ruleOut.below.isStable)&&(e[o.index]={},adjTiles=i.getAdjacentTiles(o.index),C(n,adjTiles.c,adjTiles.u)&&(e[o.index][adjTiles.u.index]=1),C(n,adjTiles.c,adjTiles.d)&&(e[o.index][adjTiles.d.index]=1),C(n,adjTiles.c,adjTiles.l)&&(e[o.index][adjTiles.l.index]=1),C(n,adjTiles.c,adjTiles.r)&&(e[o.index][adjTiles.r.index]=1)))}return e}(),dijkstra2=new function(e){this.vertices=e,this.addVertex=function(e,t){this.vertices[e]=t},this.shortestPath=function(e,t){e=e.toString(),t=t.toString();var i,n,o,s,r=new function(){this._nodes=[],this.enqueue=function(e,t){this._nodes.push({key:t,priority:e}),this.sort()},this.dequeue=function(){return this._nodes.shift().key},this.sort=function(){this._nodes.sort(function(e,t){return e.priority-t.priority})},this.isEmpty=function(){return!this._nodes.length}},l={},a={},d=[];for(n in this.vertices)n===e?(l[n]=0,r.enqueue(0,n)):(l[n]=1/0,r.enqueue(1/0,n)),a[n]=null;for(;!r.isEmpty();){if((i=r.dequeue())===t){for(d=[];a[i];)d.push(Number(i)),i=a[i];break}if(i&&l[i]!==1/0)for(o in this.vertices[i])(s=l[i]+this.vertices[i][o])<l[o]&&(l[o]=s,a[o]=i,r.enqueue(s,o))}return{path:d.concat([Number(e)]).reverse(),distance:d.length,updated:Date.now()}}}(levelGraph),i.key.space.press=function(){i.state===A?(i.shake(titleScreen,16,!1,120),T?(clearTimeout(T),i.state=D):T=i.wait(2e3,()=>{i.state=D})):i.state===D?(T&&(T=void 0),i.state=R,r.visible=!0,introScene.visible=!1):i.state===R?i.paused&&!n.dead?i.resume():i.pause():i.state!==j&&i.state!==S||location.reload()},i.key.rightArrow.press=function(){n.movement.direction=directions.right},i.key.leftArrow.press=function(){n.movement.direction=directions.left},i.key.upArrow.press=function(){n.movement.direction=directions.up},i.key.downArrow.press=function(){n.movement.direction=directions.down},i.key.a.press=function(){M("dl")},i.key.d.press=function(){M("dr")},i.key.rightArrow.release=function(){n.movement.direction===directions.right&&(n.movement.direction=directions.still)},i.key.leftArrow.release=function(){n.movement.direction===directions.left&&(n.movement.direction=directions.still)},i.key.upArrow.release=function(){n.movement.direction===directions.up&&(n.movement.direction=directions.still)},i.key.downArrow.release=function(){n.movement.direction===directions.down&&(n.movement.direction=directions.still)},i.state=A},["world.json","tileset.png"]);document.getElementById("restart").addEventListener("click",()=>{location.reload()});var n,o,s,r,l,a,d,c,u,h,p,m,f,y,v,T,g={playerMoveSpeed:150,enemyMoveSpeed:250,blockRespawnSpeed:3300,introTextFadein:2e3,pathUpdateFrequency:500,enemyUnstuckSpeed:void 0,difficulties:{easy:"easy",normal:"normal",hard:"hard"},difficulty:void 0};g.difficulty=g.difficulties.normal,g.enemyUnstuckSpeed=g.blockRespawnSpeed/3,i.start(),destroyedBlocks={queue:[],hash:{}};const x={},w={};let b=0,k=0;function S(){r.visible=!1,l.visible=!0,titleScreen.visible=!1,endMessage.content="Oh no! You're part of the building, now.",endMessage.x=155,endMessage.y=i.canvas.height/2-35}function j(){r.visible=!1,titleScreen.visible=!1,l.visible=!0,endMessage.content="You made it! Nice work!",endMessage.x=300,endMessage.y=i.canvas.height/2-35}function A(){titleScreen.visible=!0,r.visible=!1,l.visible=!1,introScene.visible=!1}function D(){r.visible=!1,titleScreen.visible=!1,l.visible=!1,introScene.visible=!0}function M(e){if(currentTile=i.getSpriteIndex(n),tileToDestroy=i.getAdjacentTile(currentTile,e),aboveTile=i.getAdjacentTile(tileToDestroy.index,directions.up),!destroyedBlocks.hash[tileToDestroy.index]&&aboveTile.type!==i.tileTypes.floor&&(spriteToDestroy=f.find(e=>e.index===tileToDestroy.index),spriteToDestroy&&spriteToDestroy.visible)){let s=1;"dl"===e&&(s*=-1);var t=i.line("yellow",3,n.centerX+10*s,n.centerY+2,spriteToDestroy.centerX+2*s,spriteToDestroy.centerY-16);i.wait(35,()=>{i.remove(t)}),a.blast(),world.children[0].data[tileToDestroy.index]=1,i.fadeOut(spriteToDestroy,15);let r={sprite:spriteToDestroy,tile:tileToDestroy,time:Date.now(),occupied:!1,occupy:function(){this.occupied=!0,world.children[0].data[this.tile.index]=2},vacate:function(){this.occupied=!1,world.children[0].data[this.tile.index]=1}};o=r,destroyedBlocks.hash[o.tile.index]=o,destroyedBlocks.queue.push(o.tile.index)}var o}function O(){let e=destroyedBlocks.queue[0],t=destroyedBlocks.hash[e];e===n.currentTile&&(a.lose(),n.dead=!0,n.visible=!1,setTimeout(function(){i.resume(),i.state=S},1500),i.pause()),delete destroyedBlocks.hash[destroyedBlocks.queue.shift()],world.children[0].data[t.tile.index]=2;i.fadeIn(t.sprite,6)}function C(e,t,n){switch(t.index-n.index){case 32:if(n.type&&t.type===i.tileTypes.ladder&&n.type!==i.tileTypes.floor)return!0;break;case-32:if(n.type&&t.type===i.tileTypes.ladder&&n.type!==i.tileTypes.floor||n.type&&n.type===i.tileTypes.ladder||n.type&&e.movement.falling)return!0;break;case-1:case 1:if(n.type&&n.type!==i.tileTypes.floor)return!0;break;default:return!1}}function B(e,t,n){let o=i.getAdjacentTile(t,directions.current),s=i.getAdjacentTile(t,n);if(canMove=C(e,o,s),canMove){let n=s.index,o=(i.getTile(t,world.objects[0].data,world),i.getTile(n,world.objects[0].data,world));return nextX=o.x,nextY=o.y,e.x=nextX,e.y=nextY,e.currentTile=n,!0}return!1}function q(e){return thisTile=i.getAdjacentTile(e.currentTile,directions.current),belowTile=i.getAdjacentTile(e.currentTile,directions.down),!(thisTile.type===i.tileTypes.ladder||belowTile.isStable||!belowTile.index)}function E(){n.movement.moving=!1}function P(e){var t;!e.dead&&destroyedBlocks.hash[e.inHoleRef.tile.index]?(e.inHoleRef.vacate(),e.unStick()):(e.dead=!0,e.visible=!1,(t=e).needsPath=!0,t.x=t.spawnX,t.y=t.spawnY,t.currentTile=i.getSpriteIndex(t),t.inHoleRef=void 0,t.freshSpawn=!0,t.movement={falling:!1,moving:!1,stuck:!1,stuckAt:void 0,direction:directions.still},t.pathData={path:null,updated:null,distance:null},setTimeout(function(){t.visible=!0},250),setTimeout(function(){t.dead=!1},1e3))}function R(){!function(){if(n.freshSpawn&&(n.movement.falling=q(n),n.freshSpawn=!1),!n.movement.moving){let e;if(n.movement.falling?e=B(n,n.currentTile,directions.down):n.movement.direction!==directions.still&&(e=B(n,n.currentTile,n.movement.direction)),e&&(a.move(),n.movement.moving=!0,i.wait(g.playerMoveSpeed,E)),n.movement.falling=q(n),n.movement.falling&&!n.landingTile)for(idx=n.currentTile;!n.landingTile;){let e=world.tileTypes[world.objects[0].data[idx]-1];e&&e.isStable?n.landingTile=idx-32:e?idx+=32:n.landingTile=idx-32}else n.movement.falling||(n.landingTile=void 0)}}(),x[n.currentTile]&&x[n.currentTile].visible&&(x[n.currentTile].visible=!1,k++,a.battery(),b===k&&(a.doorOpen(),s.forEach(e=>{e.alpha=1,e.canUse=!0}))),!n.won&&w[n.currentTile]&&w[n.currentTile].canUse&&(n.won=!0,a.win(),i.state=j),o.forEach(e=>{e.dead||(function(e){if(e.freshSpawn&&(e.movement.falling=q(e),e.freshSpawn=!1),!e.movement.moving){if(e.movement.stuck||(e.movement.falling=q(e)),!e.movement.falling&&e.needsPath){let t=0;e.movement.stuck&&(t=32),g.difficulty===g.difficulties.hard?e.pathData=dijkstra2.shortestPath(e.currentTile-t,n.movement.falling?n.landingTile:n.currentTile):e.pathData=dijkstra2.shortestPath(e.currentTile-t,n.currentTile),e.needsPath=!1}!e.movement.falling&&Date.now()-e.pathData.updated>g.pathUpdateFrequency&&(e.needsPath=!0),e.movement.stuck&&Date.now()-e.movement.stuckAt>g.enemyUnstuckSpeed&&P(e);let s=!1,r=e.pathData.path?e.pathData.path[0]:void 0,l=e.pathData.path?e.pathData.path[1]:void 0;e.movement.stuck||(e.movement.falling?(destroyedBlocks.hash[e.currentTile+32]&&!destroyedBlocks.hash[e.currentTile+32].occupied||!destroyedBlocks.hash[e.currentTile+32])&&(s=B(e,e.currentTile,directions.down)):l&&(e.movement.direction=(o=l)<(t=r)?o+1===t?directions.left:directions.up:o>t?o-1===t?directions.right:directions.down:void 0,s=B(e,r,e.movement.direction)),s&&(!e.movement.falling&&e.pathData.path&&e.pathData.path.shift(),e.movement.moving=!0,i.wait(g.enemyMoveSpeed,e.allowMoveAgain))),e.movement.stuck||(e.movement.falling=q(e))}var t,o}(e),e.movement.stuck||(e.currentTile===n.currentTile&&(a.lose(),n.dead=!0,setTimeout(function(){i.resume(),i.state=S},1500),i.pause()),function(e){let t=destroyedBlocks.hash[e.currentTile];t&&(e.makeStuck(t),t.occupy())}(e)))}),function(){try{destroyedBlocks.queue.length&&Date.now()-destroyedBlocks.hash[destroyedBlocks.queue[0]].time>g.blockRespawnSpeed&&O()}catch(e){}}()}o=[]}]);