!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([,function(e,t){var i=ga(1024,768,function(){let e=new(window.AudioContext||window.webkitAudioContext);function t(e,t,n){let s=i.sprite({image:"tileset.png",x:160,y:0,width:32,height:32});return s.spawnX=e,s.spawnY=t,s.x=s.spawnX,s.y=s.spawnY,s.id=n,s.movement={falling:!1,moving:!1,stuck:!1,stuckAt:void 0,direction:directions.still},s.allowMoveAgain=function(){s.movement.moving=!1},s.makeStuck=function(e){this.movement.moving=!1,this.movement.falling=!1,this.movement.stuck=!0,this.inHoleRef=e,this.movement.stuckAt=Date.now()},s.unStick=function(){this.movement.stuck=!1,this.inHoleRef=void 0,this.movement.stuckAt=void 0,this.climbingOut=!0},s.climbingOut=!1,s.currentTile=i.getSpriteIndex(s),s.dead=!1,s.freshSpawn=!0,s.inHoleRef=void 0,s.needsPath=!0,s.pathData={path:null,updated:null,distance:null},s}l=new class{constructor(e){this.context=e}init(){this.oscillator=this.context.createOscillator(),this.gainNode=this.context.createGain(),this.oscillator.connect(this.gainNode),this.gainNode.connect(this.context.destination),this.oscillator.type="sine"}play(e,t){this.init(),this.oscillator.frequency.value=e,this.gainNode.gain.setValueAtTime(.5,this.context.currentTime),this.oscillator.start(t),this.stop(t)}stop(e){this.gainNode.gain.exponentialRampToValueAtTime(.001,e+.25),this.oscillator.stop(e+.25)}battery(){this.play(8e3,this.context.currentTime)}move(){this.play(5,this.context.currentTime)}doorOpen(){this.play(261.63,this.context.currentTime+.25),this.play(329.63,this.context.currentTime+.35)}win(){this.play(261.63,this.context.currentTime+.25),this.play(329.63,this.context.currentTime+.35),this.play(392,this.context.currentTime+.45),this.play(523.25,this.context.currentTime+.55)}lose(){this.play(261.63,this.context.currentTime+.25),this.play(246.94,this.context.currentTime+.35),this.play(233.08,this.context.currentTime+.45)}blast(){this.play(185,this.context.currentTime+.25)}}(e),i.canvas.style.border="none",i.backgroundColor="black",endMessage=i.text("Placeholder Text","32px Consolas","#15e815",0,0),(r=i.group(endMessage)).visible=!1,introMessage1=i.text("I'm glad you're coming on shift sir! That earthquake really messed up the building!","22px Consolas","#15e815",0,0),introMessage1.x=15,introMessage1.y=150,introMessage2=i.text("Electronics are offline, batteries scattered, and the organic security is haywire!","22px Consolas","#15e815",0,0),introMessage2.x=15,introMessage2.y=185,introMessage2.visible=!1,introMessage3=i.text("Barely enough juice to open the door. You'll need all the batteries to fix it up!","22px Consolas","#15e815",0,0),introMessage3.x=15,introMessage3.y=220,introMessage3.visible=!1,introMessage4=i.text("You're the best Organic Electro-Chemical Technician we've got. You can do it! >>>","22px Consolas","#15e815",0,0),introMessage4.visible=!1,introMessage4.x=15,introMessage4.y=255,introScene=i.group(introMessage1,introMessage2,introMessage3,introMessage4),introScene.visible=!1,titleMessageMain=i.text("---- OECT ----","64px Consolas","#15e815",0,0),titleMessageSub1=i.text("By Ben Fox.","32px Consolas","#15e815",0,0),titleMessageSub2=i.text("[ SPACE ] to page/pause.","32px Consolas","#15e815",0,0),titleMessageSub3=i.text("[ A/D ] to blast the floor. [ ARROWS ] to move.","32px Consolas","#15e815",0,0),titleMessageMain.x=250,titleMessageMain.y=250,titleMessageSub1.x=400,titleMessageSub1.y=350,titleMessageSub2.x=290,titleMessageSub2.y=400,titleMessageSub3.x=100,titleMessageSub3.y=450,titleScreen=i.group(titleMessageMain,titleMessageSub1,titleMessageSub2,titleMessageSub3),titleScreen.visible=!1,world=i.makeTiledWorld("world.json","tileset.png"),o=i.group(),exits=world.getObjects(i.tileTypes.door),floors=world.getObjects(i.tileTypes.floor),ladders=world.getObjects(i.tileTypes.ladder),batteries=world.getObjects(i.tileTypes.battery),exits.forEach(e=>{o.addChild(e),e.canUse=!1,e.alpha=.25,exitHash[e.index]=e}),floors.forEach(e=>{o.addChild(e)}),batteries.forEach(e=>{o.addChild(e),batteryHash[e.index]=e}),totalBatteries=Object.keys(batteryHash).length,ladders.forEach(e=>{o.addChild(e)}),directions={up:"u",down:"d",left:"l",right:"r",current:"c",still:"still"},n=function(e,t){let n=i.sprite({image:"tileset.png",x:128,y:0,width:32,height:32});return n.spawnX=32,n.spawnY=704,n.x=n.spawnX,n.y=n.spawnY,n.dead=!1,n.won=!1,n.landingTile=void 0,n.movement={falling:!1,moving:!1,direction:directions.still},n.freshSpawn=!0,n.currentTile=i.getSpriteIndex(n),n}(),o.addChild(n),s.push(t(672,256,1)),s.push(t(0,128,2)),s.push(t(320,352,3)),s.push(t(288,32,4)),s.push(t(928,704,5)),s.forEach(e=>{o.addChild(e)}),levelGraph=function(){const e={};objects=world.objects;let t=1;for(objects.length;t<objects.length;t++){let s=objects[t];s.name!==i.tileTypes.floor&&(ruleOut={current:i.getAdjacentTile(s.index,"c"),below:i.getAdjacentTile(s.index,"d")},(ruleOut.current.type===i.tileTypes.ladder||ruleOut.below.isStable)&&(e[s.index]={},adjTiles=i.getAdjacentTiles(s.index),f(n,adjTiles.c,adjTiles.u)&&(e[s.index][adjTiles.u.index]=1),f(n,adjTiles.c,adjTiles.d)&&(e[s.index][adjTiles.d.index]=1),f(n,adjTiles.c,adjTiles.l)&&(e[s.index][adjTiles.l.index]=1),f(n,adjTiles.c,adjTiles.r)&&(e[s.index][adjTiles.r.index]=1)))}return e}(),dijkstra2=new function(e){this.vertices=e,this.addVertex=function(e,t){this.vertices[e]=t},this.shortestPath=function(e,t){e=e.toString(),t=t.toString();var i,n,s,o,r=new function(){this._nodes=[],this.enqueue=function(e,t){this._nodes.push({key:t,priority:e}),this.sort()},this.dequeue=function(){return this._nodes.shift().key},this.sort=function(){this._nodes.sort(function(e,t){return e.priority-t.priority})},this.isEmpty=function(){return!this._nodes.length}},l={},a={},d=[];for(n in this.vertices)n===e?(l[n]=0,r.enqueue(0,n)):(l[n]=1/0,r.enqueue(1/0,n)),a[n]=null;for(;!r.isEmpty();){if((i=r.dequeue())===t){for(d=[];a[i];)d.push(Number(i)),i=a[i];break}if(i&&l[i]!==1/0)for(s in this.vertices[i])(o=l[i]+this.vertices[i][s])<l[s]&&(l[s]=o,a[s]=i,r.enqueue(o,s))}return{path:d.concat([Number(e)]).reverse(),distance:d.length,updated:Date.now()}}}(levelGraph),i.key.space.press=function(){i.state===u?(i.state,i.shake(titleScreen,16,!1,120),i.wait(2e3,()=>{i.state=h})):i.state===h?(i.state=x,o.visible=!0,introScene.visible=!1):i.state===x?i.paused&&!n.dead?i.resume():i.pause():i.state!==c&&i.state!==d||location.reload()},i.key.rightArrow.press=function(){n.movement.direction=directions.right},i.key.leftArrow.press=function(){n.movement.direction=directions.left},i.key.upArrow.press=function(){n.movement.direction=directions.up},i.key.downArrow.press=function(){n.movement.direction=directions.down},i.key.a.press=function(){p("dl")},i.key.d.press=function(){p("dr")},i.key.rightArrow.release=function(){n.movement.direction===directions.right&&(n.movement.direction=directions.still)},i.key.leftArrow.release=function(){n.movement.direction===directions.left&&(n.movement.direction=directions.still)},i.key.upArrow.release=function(){n.movement.direction===directions.up&&(n.movement.direction=directions.still)},i.key.downArrow.release=function(){n.movement.direction===directions.down&&(n.movement.direction=directions.still)},i.state=u},["world.json","tileset.png"]);document.getElementById("restart").addEventListener("click",()=>{location.reload()});var n,s,o,r,l,a={playerMoveSpeed:150,enemyMoveSpeed:250,blockRespawnSpeed:3300,introTextFadein:2e3,pathUpdateFrequency:500,enemyUnstuckSpeed:void 0,difficulties:{easy:"easy",normal:"normal",hard:"hard"},difficulty:void 0};function d(){o.visible=!1,r.visible=!0,titleScreen.visible=!1,endMessage.content="Oh no! You're part of the building, now.",endMessage.x=155,endMessage.y=i.canvas.height/2-35}function c(){o.visible=!1,titleScreen.visible=!1,r.visible=!0,endMessage.content="You made it! Nice work!",endMessage.x=300,endMessage.y=i.canvas.height/2-35}function u(){titleScreen.visible=!0,o.visible=!1,r.visible=!1,introScene.visible=!1}function h(){o.visible=!1,titleScreen.visible=!1,r.visible=!1,introScene.visible=!0,i.wait(a.introTextFadein,()=>{introMessage2.visible=!0}),i.wait(2*a.introTextFadein,()=>{introMessage3.visible=!0}),i.wait(3*a.introTextFadein,()=>{introMessage4.visible=!0})}function p(e){if(currentTile=i.getSpriteIndex(n),tileToDestroy=i.getAdjacentTile(currentTile,e),aboveTile=i.getAdjacentTile(tileToDestroy.index,directions.up),!destroyedBlocks.hash[tileToDestroy.index]&&aboveTile.type!==i.tileTypes.floor&&(spriteToDestroy=floors.find(e=>e.index===tileToDestroy.index),spriteToDestroy&&spriteToDestroy.visible)){let o=1;"dl"===e&&(o*=-1);var t=i.line("yellow",3,n.centerX+10*o,n.centerY+2,spriteToDestroy.centerX+2*o,spriteToDestroy.centerY-16);i.wait(35,()=>{i.remove(t)}),l.blast(),world.children[0].data[tileToDestroy.index]=1,i.fadeOut(spriteToDestroy,15);let r={sprite:spriteToDestroy,tile:tileToDestroy,time:Date.now(),occupied:!1,occupy:function(){this.occupied=!0,world.children[0].data[this.tile.index]=2},vacate:function(){this.occupied=!1,world.children[0].data[this.tile.index]=1}};s=r,destroyedBlocks.hash[s.tile.index]=s,destroyedBlocks.queue.push(s.tile.index)}var s}function m(){let e=destroyedBlocks.queue[0],t=destroyedBlocks.hash[e];e===n.currentTile&&(l.lose(),n.dead=!0,n.visible=!1,setTimeout(function(){i.resume(),i.state=d},1500),i.pause()),delete destroyedBlocks.hash[destroyedBlocks.queue.shift()],world.children[0].data[t.tile.index]=2;i.fadeIn(t.sprite,6)}function f(e,t,n){switch(t.index-n.index){case 32:if(n.type&&t.type===i.tileTypes.ladder&&n.type!==i.tileTypes.floor)return!0;break;case-32:if(n.type&&t.type===i.tileTypes.ladder&&n.type!==i.tileTypes.floor||n.type&&n.type===i.tileTypes.ladder||n.type&&e.movement.falling)return!0;break;case-1:case 1:if(n.type&&n.type!==i.tileTypes.floor)return!0;break;default:return!1}}function g(e,t,n){let s=i.getAdjacentTile(t,directions.current),o=i.getAdjacentTile(t,n);if(canMove=f(e,s,o),canMove){let n=o.index,s=(i.getTile(t,world.objects[0].data,world),i.getTile(n,world.objects[0].data,world));return nextX=s.x,nextY=s.y,e.x=nextX,e.y=nextY,e.currentTile=n,!0}return!1}function y(e){return thisTile=i.getAdjacentTile(e.currentTile,directions.current),belowTile=i.getAdjacentTile(e.currentTile,directions.down),!(thisTile.type===i.tileTypes.ladder||belowTile.isStable||!belowTile.index)}function v(){n.movement.moving=!1}function T(e){var t;!e.dead&&destroyedBlocks.hash[e.inHoleRef.tile.index]?(e.inHoleRef.vacate(),e.unStick()):(e.dead=!0,e.visible=!1,(t=e).needsPath=!0,t.x=t.spawnX,t.y=t.spawnY,t.currentTile=i.getSpriteIndex(t),t.inHoleRef=void 0,t.freshSpawn=!0,t.movement={falling:!1,moving:!1,stuck:!1,stuckAt:void 0,direction:directions.still},t.pathData={path:null,updated:null,distance:null},setTimeout(function(){t.visible=!0},250),setTimeout(function(){t.dead=!1},1e3))}function x(){!function(){if(n.freshSpawn&&(n.movement.falling=y(n),n.freshSpawn=!1),!n.movement.moving){let e;if(n.movement.falling?e=g(n,n.currentTile,directions.down):n.movement.direction!==directions.still&&(e=g(n,n.currentTile,n.movement.direction)),e&&(l.move(),n.movement.moving=!0,i.wait(a.playerMoveSpeed,v)),n.movement.falling=y(n),n.movement.falling&&!n.landingTile)for(idx=n.currentTile;!n.landingTile;){let e=world.tileTypes[world.objects[0].data[idx]-1];e&&e.isStable?n.landingTile=idx-32:e?idx+=32:n.landingTile=idx-32}else n.movement.falling||(n.landingTile=void 0)}}(),batteryHash[n.currentTile]&&batteryHash[n.currentTile].visible&&(batteryHash[n.currentTile].visible=!1,collectedBatteries++,l.battery(),totalBatteries===collectedBatteries&&(l.doorOpen(),exits.forEach(e=>{e.alpha=1,e.canUse=!0}))),!n.won&&exitHash[n.currentTile]&&exitHash[n.currentTile].canUse&&(n.won=!0,l.win(),i.state=c),s.forEach(e=>{e.dead||(function(e){if(e.freshSpawn&&(e.movement.falling=y(e),e.freshSpawn=!1),!e.movement.moving){if(e.movement.stuck||(e.movement.falling=y(e)),!e.movement.falling&&e.needsPath){let t=0;e.movement.stuck&&(t=32),a.difficulty===a.difficulties.hard?e.pathData=dijkstra2.shortestPath(e.currentTile-t,n.movement.falling?n.landingTile:n.currentTile):e.pathData=dijkstra2.shortestPath(e.currentTile-t,n.currentTile),e.needsPath=!1}!e.movement.falling&&Date.now()-e.pathData.updated>a.pathUpdateFrequency&&(e.needsPath=!0),e.movement.stuck&&Date.now()-e.movement.stuckAt>a.enemyUnstuckSpeed&&T(e);let o=!1,r=e.pathData.path?e.pathData.path[0]:void 0,l=e.pathData.path?e.pathData.path[1]:void 0;e.movement.stuck||(e.movement.falling?(destroyedBlocks.hash[e.currentTile+32]&&!destroyedBlocks.hash[e.currentTile+32].occupied||!destroyedBlocks.hash[e.currentTile+32])&&(o=g(e,e.currentTile,directions.down)):l&&(e.movement.direction=(s=l)<(t=r)?s+1===t?directions.left:directions.up:s>t?s-1===t?directions.right:directions.down:void 0,o=g(e,r,e.movement.direction)),o&&(!e.movement.falling&&e.pathData.path&&e.pathData.path.shift(),e.movement.moving=!0,i.wait(a.enemyMoveSpeed,e.allowMoveAgain))),e.movement.stuck||(e.movement.falling=y(e))}var t,s}(e),e.movement.stuck||(e.currentTile===n.currentTile&&(l.lose(),n.dead=!0,setTimeout(function(){i.resume(),i.state=d},1500),i.pause()),function(e){let t=destroyedBlocks.hash[e.currentTile];t&&(e.makeStuck(t),t.occupy())}(e)))}),function(){try{destroyedBlocks.queue.length&&Date.now()-destroyedBlocks.hash[destroyedBlocks.queue[0]].time>a.blockRespawnSpeed&&m()}catch(e){}}()}a.difficulty=a.difficulties.normal,a.enemyUnstuckSpeed=a.blockRespawnSpeed/3,i.start(),destroyedBlocks={queue:[],hash:{}},holesWithEnemies=[],batteryHash={},exitHash={},totalBatteries=0,collectedBatteries=0,s=[]}]);